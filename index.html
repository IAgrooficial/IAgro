<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAgro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
	
	.pest-image {
            width: 60px;
            height: 60px;
            border-radius: 50%; /* Deixa a imagem redonda */
            object-fit: cover;  /* Garante que a imagem preencha o espa√ßo sem distorcer */
            margin-right: 16px; /* Adiciona um espa√ßo entre a imagem e o texto */
            border: 2px solid #e2e8f0; /* Adiciona uma borda sutil */
            flex-shrink: 0; /* Impede que a imagem encolha */
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 320px;
            background-color: #1f2937;
            color: white;
            text-align: left;
            border-radius: 8px;
            padding: 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -160px;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            line-height: 1.4;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #3b82f6 var(--progress, 0%), #e5e7eb var(--progress, 0%));
            transition: all 0.3s ease;
        }
        
        .stage-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .stage-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .stage-card.selected {
            transform: scale(1.02);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.3);
        }
        
        .pest-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .pest-card:hover {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-color: #cbd5e1;
            transform: translateY(-1px);
        }
        
        .input-field {
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .floating-label {
            position: absolute;
            top: -8px;
            left: 12px;
            background: white;
            padding: 0 4px;
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
        }
        
        .data-sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .sync-success {
            background: #10b981;
            color: white;
        }
        
        .sync-pending {
            background: #f59e0b;
            color: white;
        }
        
        .sync-error {
            background: #ef4444;
            color: white;
        }
        
        .device-info {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            border: 1px solid #81d4fa;
        }
        
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .data-source-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
            margin-left: 8px;
        }
        
        .source-local {
            background: #dcfce7;
            color: #166534;
        }
        
        .source-imported {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .source-merged {
            background: #fef3c7;
            color: #92400e;
        }
        
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            color: white;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
            cursor: help;
        }
        
        .pest-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .pest-title {
            flex: 1;
        }
        
        .beneficial-card {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #bbf7d0;
        }
        
        .beneficial-card:hover {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-color: #86efac;
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Indicador de Sincroniza√ß√£o -->
    <div id="syncIndicator" class="data-sync-indicator sync-success" style="display: none;">
        üìä Dados sincronizados
    </div>

    <!-- Modal de Configura√ß√£o de Amostragem -->
    <div id="samplingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">üå±</span>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Configurar Amostragem</h2>
                <p class="text-gray-600">Defina o n√∫mero de pontos para coleta de dados</p>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero de pontos de amostragem:</label>
                <input type="number" id="pointCount" min="1" max="20" value="5" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg font-semibold">
            </div>
            
            <div class="flex gap-3">
                <button onclick="startSampling()" 
                        class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                    Iniciar Amostragem
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Mesclagem de Dados -->
    <div id="mergeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Mesclar Dados de Diferentes Dispositivos</h3>
            <div id="mergeContent">
                <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeMergeModal()" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors">
                    Cancelar
                </button>
                <button onclick="confirmMerge()" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                    Confirmar Mesclagem
                </button>
            </div>
        </div>
    </div>

<!-- Modal do Relat√≥rio -->
<!-- Modal do Relat√≥rio -->
<div id="reportModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); padding:40px; overflow-y:auto; z-index:1000;">
  <div style="background:white; padding:20px; border-radius:10px; max-width:700px; margin:auto; max-height:90vh; overflow-y:auto;">

    <h2>Relat√≥rio Consolidado</h2>

    <!-- Conte√∫do do relat√≥rio -->
    <div id="reportContent" style="white-space:pre-wrap; margin:15px 0;">
      <!-- O texto gerado pelo Gemini vai aparecer aqui -->
    </div>

    <!-- Bot√µes -->
    <button id="closeReportBtn" style="background:#6c757d; color:white; padding:8px 15px; border:none; cursor:pointer; border-radius:4px;">
      Fechar
    </button>
    <button id="exportReportBtn" style="background:#28a745; color:white; padding:8px 15px; border:none; cursor:pointer; border-radius:4px;">
      Exportar Relat√≥rio
    </button>
  </div>
</div>


    <!-- Cabe√ßalho -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                        <span class="text-2xl">üå±</span>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">IAgro</h1>
                        <p class="text-gray-600">Sistema integrado para monitoramento de pragas e inimigos naturais</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500">Vers√£o 3.0 - Sem Imagens</div>
                    <div class="text-sm text-gray-500" id="lastSync">√öltima sincroniza√ß√£o: Agora</div>
                    <div class="device-info text-xs p-2 rounded mt-1">
                        <div>Dispositivo: <span id="deviceId" class="font-mono"></span></div>
                        <div>Pontos locais: <span id="localPointsCount">0</span></div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Barra de Progresso -->
    <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="bg-white rounded-lg p-4 shadow-md">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-gray-700" id="progressText">Amostragem n√£o iniciada</span>
                <span class="text-sm text-gray-500" id="progressPercent">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="progress-bar h-3 rounded-full" style="--progress: 0%"></div>
            </div>
        </div>
    </div>

    <!-- Container Principal -->
    <div class="max-w-7xl mx-auto px-4 pb-8">
        <!-- Informa√ß√µes Gerais -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex items-center mb-6">
                <span class="text-2xl mr-3">‚ÑπÔ∏è</span>
                <h2 class="text-2xl font-bold text-gray-800">Informa√ß√µes Gerais</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="relative">
                    <input type="date" id="dataColeta" 
                           class="input-field w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <label class="floating-label">Data da Coleta</label>
                </div>
                
                <div class="relative">
                    <input type="text" id="nomeMonitor" placeholder=" " 
                           class="input-field w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <label class="floating-label">Nome do Monitor</label>
                </div>
                
                <div class="relative">
                    <input type="text" id="propriedade" placeholder=" " 
                           class="input-field w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <label class="floating-label">Propriedade/Munic√≠pio</label>
                </div>
                
                <div class="relative">
                    <input type="text" id="cultivar" placeholder=" " 
                           class="input-field w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <label class="floating-label">Cultivar</label>
                </div>
                
                <div class="relative">
                    <input type="date" id="dataSemeadura" 
                           class="input-field w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <label class="floating-label">Data da Semeadura</label>
                </div>
                
                <div class="relative">
                    <input type="text" id="loteTalhao" placeholder=" " 
                           class="input-field w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <label class="floating-label">Lote/Talh√£o</label>
                </div>
            </div>

            <!-- Est√°gio de Desenvolvimento -->
            <div class="mt-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Est√°gio de Desenvolvimento</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="stage-card p-4 border-2 border-gray-200 rounded-lg text-center" onclick="selectStage('vegetativo')">
                        <div class="text-3xl mb-2">üå±</div>
                        <div class="font-semibold text-gray-800">Vegetativo</div>
                    </div>
                    <div class="stage-card p-4 border-2 border-gray-200 rounded-lg text-center" onclick="selectStage('floracao')">
                        <div class="text-3xl mb-2">üå∏</div>
                        <div class="font-semibold text-gray-800">Flora√ß√£o</div>
                    </div>
                    <div class="stage-card p-4 border-2 border-gray-200 rounded-lg text-center" onclick="selectStage('vagens')">
                        <div class="text-3xl mb-2">ü´ò</div>
                        <div class="font-semibold text-gray-800">Desenvolvimento de vagens</div>
                    </div>
                    <div class="stage-card p-4 border-2 border-gray-200 rounded-lg text-center" onclick="selectStage('maturacao')">
                        <div class="text-3xl mb-2">üåæ</div>
                        <div class="font-semibold text-gray-800">Matura√ß√£o</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Coleta de Dados por Ponto -->
        <div id="dataCollection" class="bg-white rounded-xl shadow-lg p-6 mb-6" style="display: none;">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                    <span class="text-2xl mr-3">üìç</span>
                    <h2 class="text-2xl font-bold text-gray-800">Coleta de Dados por Ponto</h2>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="gpsStatus" class="flex items-center space-x-2">
                        <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                        <span class="text-sm text-gray-600">GPS Indispon√≠vel</span>
                    </div>
                    <div class="text-sm text-gray-600">
                        Ponto atual: <span id="currentPoint" class="font-semibold">1</span> de <span id="totalPoints" class="font-semibold">5</span>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <button onclick="addPoint()" 
                        class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center space-x-2">
                    <span>‚ûï</span>
                    <span>Adicionar Ponto</span>
                </button>
            </div>

            <!-- PRAGAS -->
            <div class="mb-8">
                <div class="flex items-center mb-6">
                    <span class="text-2xl mr-3">üêõ</span>
                    <h3 class="text-xl font-bold text-gray-800">PRAGAS</h3>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Lagarta-da-soja -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

		            <img src="imagens/lagarta_da_soja.jpg" alt="Lagarta-da-soja" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Lagarta-da-soja</h4>
                                <p class="text-sm text-gray-600"><em>Anticarsia gemmatalis</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Lagarta-da-soja (Anticarsia gemmatalis)</strong><br>
                                    √â a principal praga da cultura da soja, sendo importante pelo seu potencial de consumo foliar. A fase de lagarta dura, em m√©dia, 20 dias, passando por seis est√°dios de desenvolvimento (instares).<br>
                                    <strong>N√≠vel de controle:</strong> Antes da flora√ß√£o: 30% de desfolha ou 20 lagartas grandes (>1,5 cm) por metro. Ap√≥s a flora√ß√£o: 15% de desfolha ou 20 lagartas grandes por metro.<br>
                                    <strong>Danos:</strong> Desfolha<br>
                                    <strong>Identifica√ß√£o:</strong> As lagartas medem at√© 40 mm de comprimento, apresentam colora√ß√£o que varia do verde-claro ao escuro, com listras brancas ou amareladas no dorso e uma linha branca em cada lado do corpo. Possuem tr√™s pares de pernas tor√°cicas e quatro pares de pernas abdominais. Quando tocadas, movimentam-se bruscamente para tr√°s.
                                </span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Pequena (&lt;1.5cm)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="lagarta_soja" data-stage="pequena">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Grande (&gt;1.5cm)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="lagarta_soja" data-stage="grande">
                            </div>
                        </div>
                        <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">
                            ‚ö†Ô∏è N√≠vel de controle: 20 lagartas > 1.5 cm/m
                        </div>
                    </div>

                    <!-- Lagarta-falsa-medideira -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/lagarta_falsa_medideira.JPG" alt="Lagarta-falsa-medideira" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Lagarta-falsa-medideira</h4>
                                <p class="text-sm text-gray-600"><em>Chrysodeixis includens</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Lagarta-falsa-medideira (Chrysodeixis includens)</strong><br>
                                    √â uma das principais pragas desfolhadoras da soja. As lagartas se alimentam das folhas, raspando o limbo foliar e deixando as nervuras intactas, o que confere √† folha um aspecto rendilhado.<br>
                                    <strong>N√≠vel de controle:</strong> Antes da flora√ß√£o: 30% de desfolha ou 20 lagartas grandes (>1,5 cm) por metro. Ap√≥s a flora√ß√£o: 15% de desfolha ou 20 lagartas grandes por metro.<br>
                                    <strong>Danos:</strong> Desfolha, principalmente em folhas novas.<br>
                                    <strong>Identifica√ß√£o:</strong> Lagarta de colora√ß√£o verde-clara, com duas listras brancas longitudinais no dorso e uma linha amarela em cada lado do corpo. Possui tr√™s pares de pernas tor√°cicas e dois pares de falsas pernas abdominais, o que a faz se locomover arqueando o corpo.
                                </span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Pequena (&lt;1.5cm)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="lagarta_falsa_medideira" data-stage="pequena">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Grande (&gt;1.5cm)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="lagarta_falsa_medideira" data-stage="grande">
                            </div>
                        </div>
                        <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">
                            ‚ö†Ô∏è N√≠vel de controle: 10 lagartas/m ou 10% de vagens danificadas
                        </div>
                    </div>

                    <!-- Lagarta-das-vagens -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/lagarta_das_vagens.jpeg" alt="Lagarta-das-vagens" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Lagarta-das-vagens</h4>
                                <p class="text-sm text-gray-600"><em>Spodoptera spp.</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Lagarta-das-vagens (Spodoptera spp.)</strong><br>
                                    Este complexo de lagartas, incluindo esp√©cies como *Spodoptera eridania* e *Spodoptera cosmioides*, √© uma praga importante na cultura da soja, especialmente durante o per√≠odo reprodutivo. As lagartas se alimentam das vagens, causando danos diretos aos gr√£os.<br>
                                    <strong>N√≠vel de controle:</strong> 4 lagartas/m no est√°gio vegetativo; 2 lagartas/m no est√°gio reprodutivo (Embrapa).<br>
                                    <strong>Danos:</strong> Perfura√ß√£o de vagens, consumo de gr√£os, redu√ß√£o da qualidade e produtividade da soja.<br>
                                    <strong>Identifica√ß√£o:</strong> As lagartas apresentam colora√ß√£o vari√°vel, geralmente esverdeada ou amarronzada, com listras longitudinais. Possuem h√°bito noturno e causam danos vis√≠veis nas vagens, como orif√≠cios e gr√£os ro√≠dos.
                                </span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Pequena (&lt;1.5cm)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="lagarta_vagens" data-stage="pequena">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Grande (&gt;1.5cm)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="lagarta_vagens" data-stage="grande">
                            </div>
                        </div>
                        <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">
                            ‚ö†Ô∏è N√≠vel de controle: 4 lagartas/m - vegetativo; 2 lagartas/m - reprodutivo
                        </div>
                    </div>

                    <!-- Lagartas do grupo Heliothinae -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/lagarta_helicoverpa.jpg" alt="Lagarta-helicoverpa" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Lagartas do grupo Heliothinae</h4>
                                <p class="text-sm text-gray-600"><em>Helicoverpa spp., Heliothis spp.</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Lagartas do grupo Heliothinae (Helicoverpa spp., Heliothis spp.)</strong><br>
                                    Este grupo inclui esp√©cies como *Helicoverpa armigera* e *Heliothis virescens*, que s√£o pragas pol√≠fagas e podem causar s√©rios danos √† soja, atacando folhas, flores e vagens.<br>
                                    <strong>N√≠vel de controle:</strong> Desfolhamento: 30% at√© o florescimento ou 15% ap√≥s o florescimento. Em vagens: 1 lagarta/m.<br>
                                    <strong>Danos:</strong> Desfolhamento, perfura√ß√£o de flores e vagens, consumo de gr√£os, resultando em perdas de produtividade.<br>
                                    <strong>Identifica√ß√£o:</strong> As lagartas variam em colora√ß√£o, mas frequentemente apresentam listras longitudinais. *H. armigera* possui microespinhos na base das cerdas e *H. virescens* tem corpo mais liso. Ambas preferem atacar estruturas reprodutivas.</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Pequena (&lt;1.5cm)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="lagarta_heliothinae" data-stage="pequena">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Grande (&gt;1.5cm)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="lagarta_heliothinae" data-stage="grande">
                            </div>
                        </div>
                        <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">
                            ‚ö†Ô∏è Desfolhamento: 30% at√© o florescimento ou 15% ap√≥s
                        </div>
                    </div>

                    <!-- Percevejo-verde -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/percevejo_verde.jpg" alt="percevejo-verde" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Percevejo-verde</h4>
                                <p class="text-sm text-gray-600"><em>Nezara viridula</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Percevejo-verde (Nezara viridula)</strong><br>
                                    √â uma das esp√©cies de percevejos mais comuns e importantes na cultura da soja. Ataca as vagens e os gr√£os em desenvolvimento, causando danos diretos √† produ√ß√£o.<br>
                                    <strong>N√≠vel de controle:</strong> Em lavouras destinadas √† produ√ß√£o de gr√£os: 2 percevejos (ninfas de 3¬∫ ao 5¬∫ instar + adultos) por metro. Em lavouras destinadas √† produ√ß√£o de sementes: 1 percevejo (ninfas de 3¬∫ ao 5¬∫ instar + adultos) por metro.<br>
                                    <strong>Danos:</strong> Suc√ß√£o de seiva das vagens e gr√£os, causando chochamento, enrugamento, m√° forma√ß√£o e redu√ß√£o do peso dos gr√£os. Pode tamb√©m transmitir doen√ßas.<br>
                                    <strong>Identifica√ß√£o:</strong> Adultos de colora√ß√£o verde brilhante, formato pentagonal e tamanho m√©dio (cerca de 1,5 cm). Ninfas passam por cinco instares, variando de colora√ß√£o e padr√£o de manchas ao longo do desenvolvimento.</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Ninfa (3¬∫-5¬∫ instar)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="percevejo_verde" data-stage="ninfa">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Adulto</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="percevejo_verde" data-stage="adulto">
                            </div>
                        </div>
                        <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">
                            ‚ö†Ô∏è Lavoura Gr√£o: 2 perc./m; Lavoura Semente: 1 perc./m
                        </div>
                    </div>

                    <!-- Percevejo-pequeno -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/percevejo_pequeno.jpeg" alt="percevejo_pequeno" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Percevejo-pequeno</h4>
                                <p class="text-sm text-gray-600"><em>Piezodorus guildinii</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Percevejo-pequeno (Piezodorus guildinii)</strong><br>
                                    Tamb√©m conhecido como percevejo-verde-pequeno, √© uma praga sugadora que ataca as vagens e gr√£os da soja, causando danos similares aos do percevejo-verde. Sua import√¢ncia tem crescido em algumas regi√µes.<br>
                                    <strong>N√≠vel de controle:</strong> O n√≠vel de controle √© o mesmo para o complexo de percevejos, ou seja, 2 percevejos (ninfas de 3¬∫ ao 5¬∫ instar + adultos) por metro em lavouras de gr√£os e 1 percevejo por metro em lavouras de sementes.<br>
                                    <strong>Danos:</strong> Suc√ß√£o de seiva, resultando em gr√£os chochos, enrugados e manchados, al√©m de poder causar reten√ß√£o foliar.<br>
                                    <strong>Identifica√ß√£o:</strong> Adultos s√£o menores que o percevejo-verde, com colora√ß√£o verde-amarelada e formato mais alongado. Possuem uma mancha escura na parte superior do escutelo.</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Ninfa (3¬∫-5¬∫ instar)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="percevejo_pequeno" data-stage="ninfa">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Adulto</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="percevejo_pequeno" data-stage="adulto">
                            </div>
                        </div>
                    </div>

                    <!-- Percevejo-marrom -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/percevejo_marrom.jpg" alt="percevejo_marrom" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Percevejo-marrom</h4>
                                <p class="text-sm text-gray-600"><em>Euschistus heros</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Percevejo-marrom (Euschistus heros)</strong><br>
                                    √â a esp√©cie de percevejo mais abundante e prejudicial √† cultura da soja no Brasil. Causa danos diretos aos gr√£os, comprometendo a qualidade e a produtividade.<br>
                                    <strong>N√≠vel de controle:</strong> O n√≠vel de controle √© o mesmo para o complexo de percevejos, ou seja, 2 percevejos (ninfas de 3¬∫ ao 5¬∫ instar + adultos) por metro em lavouras de gr√£os e 1 percevejo por metro em lavouras de sementes.<br>
                                    <strong>Danos:</strong> Suc√ß√£o de seiva das vagens e gr√£os, resultando em gr√£os chochos, enrugados, manchados e com menor teor de √≥leo. Pode causar reten√ß√£o foliar e, em ataques severos, a morte da planta.<br>
                                    <strong>Identifica√ß√£o:</strong> Adultos de colora√ß√£o marrom-escura, formato robusto e espinhos laterais proeminentes no t√≥rax. Possuem cerca de 1,5 a 2 cm de comprimento. Ninfas s√£o de colora√ß√£o mais clara, com manchas escuras.</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Ninfa (3¬∫-5¬∫ instar)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="percevejo_marrom" data-stage="ninfa">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Adulto</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="percevejo_marrom" data-stage="adulto">
                            </div>
                        </div>
                    </div>

                    <!-- Percevejo-barriga-verde -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/percevejo_barriga.jpeg" alt="percevejo_barriga" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Percevejo-barriga-verde</h4>
                                <p class="text-sm text-gray-600"><em>Dichelops melacanthus</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Percevejo-barriga-verde (Dichelops melacanthus)</strong><br>
                                    √â uma praga de solo que ataca a soja principalmente no in√≠cio do desenvolvimento da cultura (est√°gios de pl√¢ntula). Pode causar danos severos, levando √† morte de pl√¢ntulas ou perfilhamento.<br>
                                    <strong>N√≠vel de controle:</strong> Monitoramento intensivo em plantas jovens. O n√≠vel de controle varia conforme a regi√£o e o hist√≥rico da √°rea, mas geralmente √© baixo (ex: 1 percevejo/m em algumas situa√ß√µes).<br>
                                    <strong>Danos:</strong> Corte de pl√¢ntulas, perfilhamento, redu√ß√£o do estande e da produtividade. Os danos s√£o mais severos em condi√ß√µes de estresse h√≠drico.<br>
                                    <strong>Identifica√ß√£o:</strong> Adultos de colora√ß√£o marrom-escura com abdome de colora√ß√£o verde-clara (barriga-verde). Possuem espinhos proeminentes na lateral do pronoto. Ninfas s√£o menores e de colora√ß√£o mais clara.</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Ninfa (3¬∫-5¬∫ instar)</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="percevejo_barriga_verde" data-stage="ninfa">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Adulto</label>
                                <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       data-pest="percevejo_barriga_verde" data-stage="adulto">
                            </div>
                        </div>
                    </div>

                    <!-- Broca-dos-ponteiros -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/broca_ponteiros.jpg" alt="broca-ponteiros" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Broca-dos-ponteiros</h4>
                                <p class="text-sm text-gray-600"><em>Crocidosema aporema</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Broca-dos-ponteiros (Crocidosema aporema)</strong><br>
                                    √â uma lagarta que ataca os brotos terminais (ponteiros) da soja, causando a morte do ponto de crescimento e, consequentemente, a bifurca√ß√£o da haste principal. Os danos s√£o mais significativos em plantas jovens.<br>
                                    <strong>N√≠vel de controle:</strong> 25% a 30% das plantas com ponteiros atacados.<br>
                                    <strong>Danos:</strong> Morte do broto terminal, bifurca√ß√£o da haste, redu√ß√£o do porte da planta e da produtividade.<br>
                                    <strong>Identifica√ß√£o:</strong> A lagarta √© pequena, de colora√ß√£o esbranqui√ßada a rosada, e vive protegida dentro do broto. A presen√ßa de orif√≠cios e res√≠duos de excrementos no ponteiro s√£o indicativos de sua presen√ßa.</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">N¬∫ de Plantas</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   data-pest="broca_ponteiros" data-stage="plantas">
                        </div>
                        <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">
                            ‚ö†Ô∏è N√≠vel de controle: 25 a 30% das plantas c/ ponteiros atacados
                        </div>
                    </div>

                    <!-- Tamandu√°-da-soja -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/tamandua_soja.jpg" alt="tamandua-soja" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Tamandu√°-da-soja</h4>
                                <p class="text-sm text-gray-600"><em>Sternechus subsignatus</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Tamandu√°-da-soja (Sternechus subsignatus)</strong><br>
                                    √â um besouro da fam√≠lia Curculionidae, considerado uma praga importante da soja, especialmente nas fases iniciais de desenvolvimento da cultura. Os adultos se alimentam do caule e pec√≠olos, e as larvas se desenvolvem dentro do caule e ra√≠zes.<br>
                                    <strong>N√≠vel de controle:</strong> 1 adulto/m (at√© o est√°gio V3 da soja).<br>
                                    <strong>Danos:</strong> Os adultos causam an√©is de raspagem no caule e pec√≠olos, que podem levar √† quebra da planta. As larvas, ao se desenvolverem no interior do caule e ra√≠zes, causam murcha, amarelecimento e morte das plantas, al√©m de dificultar a colheita.<br>
                                    <strong>Identifica√ß√£o:</strong> Adultos s√£o besouros pequenos (cerca de 0,5 cm), de colora√ß√£o escura e com um rostro (tromba) alongado caracter√≠stico. As larvas s√£o brancas, sem pernas e com cabe√ßa marrom, encontradas dentro do caule.</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Adulto</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   data-pest="tamandua_soja" data-stage="adulto">
                        </div>
                        <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">
                            ‚ö†Ô∏è N√≠vel de controle (at√© V3): 1 adulto/m
                        </div>
                    </div>

                    <!-- Vaquinhas -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/vaquinhas.jpg" alt="vaquinhas" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Vaquinhas</h4>
                                <p class="text-sm text-gray-600"><em>Diabrotica speciosa, Cerotoma spp., Colaspis spp.</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Vaquinhas (Diabrotica speciosa, Cerotoma arcuata, Colaspis spp.)</strong><br>
                                    Complexo de besouros desfolhadores que atacam a soja em diversas fases, principalmente em plantas jovens.<br>
                                    <strong>N√≠vel de controle:</strong> 2 adultos/m (do est√°gio V4 ao V6).<br>
                                    <strong>Danos:</strong> Desfolhamento, raspagem de folhas, e em ataques severos, podem causar a morte de pl√¢ntulas.<br>
                                    <strong>Identifica√ß√£o:</strong> Besouros pequenos, com colora√ß√£o e padr√µes variados (ex: *Diabrotica speciosa* √© verde-amarelada com pintas pretas; *Cerotoma arcuata* √© preta com manchas amarelas).
                        </div>
                     </div>
                     <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Adulto</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   data-pest="vaquinhas" data-stage="adulto">

                        <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">
                            ‚ö†Ô∏è N√≠vel de controle (V4-V6): 2 adultos/m
                        </div>
                    </div>

                    <!-- Torr√£ozinho -->
                    <div class="pest-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/torraozinho.jpg" alt="torraozinho" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Torr√£ozinho</h4>
                                <p class="text-sm text-gray-600"><em>Aracanthus mourei</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Torr√£ozinho (Aracanthus mourei)</strong><br>
                                    √â um besouro desfolhador que pode causar danos √† soja, principalmente em √°reas com hist√≥rico de ocorr√™ncia. Os adultos se alimentam das folhas, causando perfura√ß√µes.<br>
                                    <strong>N√≠vel de controle:</strong> O n√≠vel de controle √© baseado no percentual de desfolha: 30% at√© o florescimento ou 15% ap√≥s o florescimento.<br>
                                    <strong>Danos:</strong> Desfolhamento das plantas, que pode afetar a capacidade fotossint√©tica e, consequentemente, a produtividade.<br>
                                    <strong>Identifica√ß√£o:</strong> Adultos s√£o besouros pequenos, de colora√ß√£o escura e corpo robusto. Geralmente s√£o encontrados nas folhas da soja, onde realizam as perfura√ß√µes caracter√≠sticas.
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Adulto</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   data-pest="torraozinho" data-stage="adulto">
                        </div>
                        <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">
                            ‚ö†Ô∏è Desfolha: 30% at√© o florescimento ou 15% ap√≥s
                        </div>
                    </div>
                </div>

                <!-- Outros Insetos -->
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Outros Insetos (Observa√ß√µes)</label>
                    <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                              rows="3" placeholder="Descreva outras pragas observadas..."></textarea>
                </div>
            </div>

            <!-- INIMIGOS NATURAIS E DOEN√áAS -->
            <div class="mb-8">
                <div class="flex items-center mb-6">
                    <span class="text-2xl mr-3">ü¶∏</span>
                    <h3 class="text-xl font-bold text-gray-800">MONITORAMENTO DOS INIMIGOS NATURAIS E DOEN√áAS</h3>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Nomuraea -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">

                            <img src="imagens/branca.jpg" alt="branca" class="pest-image">

                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Nomuraea (doen√ßa branca)</h4>
                                <p class="text-sm text-gray-600"><em>Nomuraea rileyi</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Nomuraea (doen√ßa branca) - Nomuraea rileyi</strong><br>
                                    Fungo entomopatog√™nico que infecta lagartas, causando a 'doen√ßa branca'. √â um importante agente de controle biol√≥gico natural.<br>
                                    <strong>Benef√≠cio:</strong> Controle natural de lagartas desfolhadoras<br>
                                    <strong>Identifica√ß√£o:</strong> Lagartas mortas com colora√ß√£o esbranqui√ßada devido ao crescimento do fungo<br>
                                    <strong>Condi√ß√µes favor√°veis:</strong> Alta umidade e temperatura entre 20-30¬∞C
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="nomuraea" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Baculovirus -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/preta.jpg" alt="preta" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Baculovirus (doen√ßa preta)</h4>
                                <p class="text-sm text-gray-600"><em>Baculovirus anticarsia</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Baculovirus (doen√ßa preta) - Baculovirus anticarsia</strong><br>
                                    V√≠rus que infecta especificamente a lagarta-da-soja, causando a 'doen√ßa preta'. Usado em programas de controle biol√≥gico.<br>
                                    <strong>Benef√≠cio:</strong> Controle espec√≠fico da lagarta-da-soja<br>
                                    <strong>Identifica√ß√£o:</strong> Lagartas mortas com colora√ß√£o escura, corpo fl√°cido<br>
                                    <strong>Aplica√ß√£o:</strong> Pode ser aplicado como bioinseticida
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="baculovirus" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Calosoma granulatum -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/calosoma.jpg" alt="calosoma" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Calosoma</h4>
                                <p class="text-sm text-gray-600"><em>Calosoma granulatum</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Calosoma granulatum</strong><br>
                                    Besouro predador que se alimenta de lagartas e outros insetos. √â um importante inimigo natural das pragas da soja.<br>
                                    <strong>Benef√≠cio:</strong> Preda√ß√£o de lagartas e outras pragas<br>
                                    <strong>Identifica√ß√£o:</strong> Besouro grande, colora√ß√£o met√°lica, movimentos r√°pidos<br>
                                    <strong>Comportamento:</strong> Ativo durante o dia, ca√ßa ativamente no solo e plantas
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="calosoma" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Callida sp. -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/callida.jpg" alt="callida" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Callida</h4>
                                <p class="text-sm text-gray-600"><em>Callida sp.</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Callida sp.</strong><br>
                                    Besouro predador que se alimenta de ovos e lagartas pequenas de lepid√≥pteros.<br>
                                    <strong>Benef√≠cio:</strong> Preda√ß√£o de ovos e lagartas jovens<br>
                                    <strong>Identifica√ß√£o:</strong> Besouro pequeno, colora√ß√£o alaranjada<br>
                                    <strong>Comportamento:</strong> Ativo na superf√≠cie das plantas, especialista em ovos
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="callida_sp" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Callida scutellaris -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/Callidio.jpg" alt="callidio" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Callida-scutellaris</h4>
                                <p class="text-sm text-gray-600"><em>Callida scutellaris</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Callida scutellaris</strong><br>
                                    Esp√©cie espec√≠fica de Callida, importante predador de ovos e lagartas pequenas.<br>
                                    <strong>Benef√≠cio:</strong> Preda√ß√£o especializada de ovos e lagartas<br>
                                    <strong>Identifica√ß√£o:</strong> Similar √† Callida sp., mas com caracter√≠sticas espec√≠ficas<br>
                                    <strong>Efici√™ncia:</strong> Alta capacidade de localizar e consumir ovos de pragas
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="callida_scutellaris" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Lebia concinna -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/lebia.jpeg" alt="lebia" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Lebia</h4>
                                <p class="text-sm text-gray-600"><em>Lebia concinna</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Lebia concinna</strong><br>
                                    Besouro predador que se alimenta de ovos e lagartas pequenas.<br>
                                    <strong>Benef√≠cio:</strong> Controle de pragas em est√°gios iniciais<br>
                                    <strong>Identifica√ß√£o:</strong> Besouro pequeno, ativo na superf√≠cie das plantas<br>
                                    <strong>Habitat:</strong> Encontrado principalmente nas folhas e estruturas da planta
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="lebia_concinna" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Eriopsis connexa -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/joaninha.jpeg" alt="joaninha" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Joaninha</h4>
                                <p class="text-sm text-gray-600"><em>Eriopsis connexa</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Joaninha (Eriopsis connexa)</strong><br>
                                    Joaninha predadora que se alimenta principalmente de pulg√µes, mas tamb√©m de outros insetos pequenos.<br>
                                    <strong>Benef√≠cio:</strong> Controle de pulg√µes e pequenos insetos<br>
                                    <strong>Identifica√ß√£o:</strong> Joaninha de colora√ß√£o alaranjada com pontos pretos<br>
                                    <strong>Capacidade:</strong> Pode consumir at√© 50 pulg√µes por dia
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="eriopsis_connexa" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Cycloneda sanguinea -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/cycloneda.jpg" alt="cycloneda" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Joaninha-vermelha</h4>
                                <p class="text-sm text-gray-600"><em>Cycloneda sanguinea</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Joaninha-vermelha (Cycloneda sanguinea)</strong><br>
                                    Joaninha predadora de colora√ß√£o vermelha, importante no controle de pulg√µes.<br>
                                    <strong>Benef√≠cio:</strong> Preda√ß√£o de pulg√µes e pequenos insetos<br>
                                    <strong>Identifica√ß√£o:</strong> Joaninha vermelha, sem pontos ou com poucos pontos<br>
                                    <strong>Distribui√ß√£o:</strong> Amplamente distribu√≠da, muito comum na soja
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="cycloneda_sanguinea" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Podisus sp. -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/podisus.jpeg" alt="podisus" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Percevejo-predador</h4>
                                <p class="text-sm text-gray-600"><em>Podisus sp.</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Percevejo-predador (Podisus sp.)</strong><br>
                                    Percevejo predador que se alimenta de lagartas e outros insetos. Importante agente de controle biol√≥gico.<br>
                                    <strong>Benef√≠cio:</strong> Preda√ß√£o de lagartas e outras pragas<br>
                                    <strong>Identifica√ß√£o:</strong> Percevejo robusto, rostro adaptado para preda√ß√£o<br>
                                    <strong>Comportamento:</strong> Injeta enzimas digestivas nas presas, sugando o conte√∫do
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="podisus_sp" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Tropiconabis sp. -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/tropicanabis.jpeg" alt="tropicanabis" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Tropiconabis</h4>
                                <p class="text-sm text-gray-600"><em>Tropiconabis sp.</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Tropiconabis sp.</strong><br>
                                    Percevejo predador que se alimenta de pequenos insetos e ovos.<br>
                                    <strong>Benef√≠cio:</strong> Controle de pragas em est√°gios iniciais<br>
                                    <strong>Identifica√ß√£o:</strong> Percevejo pequeno, colora√ß√£o vari√°vel<br>
                                    <strong>Especialidade:</strong> Eficiente na preda√ß√£o de ovos e insetos jovens
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="tropiconabis_sp" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Geocoris sp. -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/Geocoris.jpg" alt="geocoris" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Geocoris</h4>
                                <p class="text-sm text-gray-600"><em>Geocoris sp.</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Geocoris sp.</strong><br>
                                    Percevejo predador que se alimenta de ovos e pequenos insetos.<br>
                                    <strong>Benef√≠cio:</strong> Preda√ß√£o de ovos e insetos pequenos<br>
                                    <strong>Identifica√ß√£o:</strong> Percevejo pequeno, olhos proeminentes<br>
                                    <strong>Habitat:</strong> Encontrado no solo e na base das plantas
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="geocoris_sp" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Doru sp. (tesourinha) -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/tesoura.jpeg" alt="tesoura" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Tesourinha</h4>
                                <p class="text-sm text-gray-600"><em>Doru sp.</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Tesourinha (Doru sp.)</strong><br>
                                    Inseto predador com f√≥rceps no abdome, alimenta-se de ovos e lagartas pequenas.<br>
                                    <strong>Benef√≠cio:</strong> Preda√ß√£o de ovos e lagartas jovens<br>
                                    <strong>Identifica√ß√£o:</strong> Inseto alongado com f√≥rceps caracter√≠sticos no abdome<br>
                                    <strong>Comportamento:</strong> Ativo durante a noite, esconde-se durante o dia
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="doru_sp" data-stage="contagem">
                        </div>
                    </div>

                    <!-- Aranhas -->
                    <div class="beneficial-card p-4 rounded-lg">
                        <div class="pest-header">
                            <img src="imagens/aranhas.jpeg" alt="aranhas" class="pest-image">
                            <div class="pest-title">
                                <h4 class="font-semibold text-gray-800">Aranhas</h4>
                                <p class="text-sm text-gray-600"><em>V√°rias fam√≠lias</em></p>
                            </div>
                            <div class="tooltip">
                                <div class="info-icon">i</div>
                                <span class="tooltiptext">
                                    <strong>Aranhas (V√°rias fam√≠lias)</strong><br>
                                    Predadores generalistas que capturam diversos tipos de insetos atrav√©s de teias ou ca√ßa ativa.<br>
                                    <strong>Benef√≠cio:</strong> Controle geral de insetos pragas<br>
                                    <strong>Identifica√ß√£o:</strong> Aracn√≠deos com oito patas, diversos tamanhos e cores<br>
                                    <strong>Estrat√©gias:</strong> Teias, ca√ßa ativa, emboscada
                                </span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Contagem</label>
                            <input type="number" min="0" class="pest-input w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                   data-beneficial="aranhas" data-stage="contagem">
                        </div>
                    </div>
                </div>

                <!-- Outros Inimigos Naturais -->
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Outros Inimigos Naturais (Observa√ß√µes)</label>
                    <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                              rows="3" placeholder="Descreva outros inimigos naturais observados..."></textarea>
                </div>
            </div>
        </div>

        <!-- Exportar Dados -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center mb-6">
                <span class="text-2xl mr-3">üìä</span>
                <h2 class="text-2xl font-bold text-gray-800">Gerenciamento de Dados</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <button onclick="exportCSV()" 
                        class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold flex items-center justify-center space-x-2">
                    <span>üìÑ</span>
                    <span>Exportar CSV</span>
                </button>
                
                <button onclick="exportJSON()" 
                        class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center justify-center space-x-2">
                    <span>üìã</span>
                    <span>Exportar JSON</span>
                </button>
                
                <button onclick="importData()" 
                        class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors font-semibold flex items-center justify-center space-x-2">
                    <span>üì•</span>
                    <span>Importar/Mesclar</span>
                </button>
                
                <button onclick="generateConsolidatedReport()" 
                        class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-semibold flex items-center justify-center space-x-2">
                    <span>üìà</span>
                    <span>Relat√≥rio Consolidado</span>
                </button>
                
                <button onclick="syncWithCloud()" 
                        class="bg-cyan-600 text-white px-6 py-3 rounded-lg hover:bg-cyan-700 transition-colors font-semibold flex items-center justify-center space-x-2">
                    <span>‚òÅÔ∏è</span>
                    <span>Sincronizar Nuvem</span>
                </button>
                
                <button onclick="clearData()" 
                        class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors font-semibold flex items-center justify-center space-x-2">
                    <span>üóëÔ∏è</span>
                    <span>Limpar Dados</span>
                </button>
            </div>
            
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(event)">
            
            <div class="text-sm text-gray-600 bg-gray-50 p-4 rounded-lg">
                <p class="mb-2"><strong>üíæ Armazenamento autom√°tico:</strong> Os dados s√£o salvos automaticamente no seu navegador</p>
                <p class="mb-2"><strong>üîÑ Sincroniza√ß√£o multi-dispositivo:</strong> Use a fun√ß√£o de importar/mesclar para combinar dados de diferentes dispositivos</p>
                <p class="mb-2"><strong>üìä Relat√≥rios consolidados:</strong> Gere relat√≥rios que combinam dados de m√∫ltiplas coletas</p>
                <p class="mb-2"><strong>‚ÑπÔ∏è Informa√ß√µes detalhadas:</strong> Passe o mouse sobre os √≠cones "i" para ver informa√ß√µes detalhadas sobre cada praga/inimigo natural</p>
                <p><strong>üì± Compatibilidade:</strong> Funciona em computadores, tablets e smartphones</p>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let samplingData = {
            deviceId: generateDeviceId(),
            generalInfo: {},
            points: [],
            currentPoint: 0,
            totalPoints: 5,
            stage: '',
            metadata: {
                version: '3.0-sem-imagens',
                created: new Date().toISOString(),
                lastModified: new Date().toISOString()
            }
        };

        let gpsAvailable = false;
        let pendingMergeData = null;

      const serverUrl = 'https://iagro-server.onrender.com';


        // Gerar ID √∫nico do dispositivo
        function generateDeviceId() {
            let deviceId = localStorage.getItem('mipSojaDeviceId');
            if (!deviceId) {
                deviceId = 'DEV_' + Math.random().toString(36).substr(2, 9).toUpperCase();
                localStorage.setItem('mipSojaDeviceId', deviceId);
            }
            return deviceId;
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual
            document.getElementById('dataColeta').value = new Date().toISOString().split('T')[0];
            
            // Mostrar ID do dispositivo
            document.getElementById('deviceId').textContent = samplingData.deviceId;
            
            // Verificar GPS
            checkGPSAvailability();
            
            // Carregar dados salvos
            loadSavedData();
            
            // Configurar listeners para auto-save
            setupAutoSave();
            
            // Atualizar contador de pontos locais
            updateLocalPointsCount();
        });

        // Verificar disponibilidade do GPS
        function checkGPSAvailability() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        gpsAvailable = true;
                        updateGPSStatus('available');
                    },
                    function(error) {
                        gpsAvailable = false;
                        updateGPSStatus('denied');
                    }
                );
            } else {
                gpsAvailable = false;
                updateGPSStatus('unavailable');
            }
        }

        // Atualizar status do GPS
        function updateGPSStatus(status) {
            const gpsStatus = document.getElementById('gpsStatus');
            const statusElement = gpsStatus.querySelector('span:first-child');
            const textElement = gpsStatus.querySelector('span:last-child');
            
            switch(status) {
                case 'available':
                    statusElement.className = 'w-3 h-3 bg-green-500 rounded-full';
                    textElement.textContent = 'GPS Dispon√≠vel';
                    break;
                case 'denied':
                    statusElement.className = 'w-3 h-3 bg-red-500 rounded-full';
                    textElement.textContent = 'GPS Negado';
                    break;
                case 'unavailable':
                    statusElement.className = 'w-3 h-3 bg-gray-500 rounded-full';
                    textElement.textContent = 'GPS Indispon√≠vel';
                    break;
            }
        }

        // Atualizar contador de pontos locais
        function updateLocalPointsCount() {
            document.getElementById('localPointsCount').textContent = samplingData.points.length;
        }

        // Iniciar amostragem
        function startSampling() {
            const pointCount = parseInt(document.getElementById('pointCount').value);
            if (pointCount < 1 || pointCount > 20) {
                alert('Por favor, insira um n√∫mero v√°lido de pontos (1-20)');
                return;
            }
            
            samplingData.totalPoints = pointCount;
            samplingData.currentPoint = 1;
            samplingData.points = [];
            
            document.getElementById('totalPoints').textContent = pointCount;
            document.getElementById('currentPoint').textContent = '1';
            
            document.getElementById('samplingModal').style.display = 'none';
            document.getElementById('dataCollection').style.display = 'block';
            
            updateProgress();
        }

        // Selecionar est√°gio de desenvolvimento
        function selectStage(stage) {
            // Remover sele√ß√£o anterior
            document.querySelectorAll('.stage-card').forEach(card => {
                card.classList.remove('selected');
                card.style.borderColor = '#e5e7eb';
            });
            
            // Adicionar sele√ß√£o atual
            event.target.closest('.stage-card').classList.add('selected');
            event.target.closest('.stage-card').style.borderColor = '#3b82f6';
            
            samplingData.stage = stage;
            saveData();
        }

        // Adicionar ponto
        function addPoint() {
            if (samplingData.currentPoint > samplingData.totalPoints) {
                alert('Todos os pontos j√° foram coletados!');
                return;
            }
            
            // Coletar dados do formul√°rio
            const pointData = collectCurrentPointData();
            
            // Tentar obter coordenadas GPS
            if (gpsAvailable) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        pointData.coordinates = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: new Date().toISOString()
                        };
                        
                        savePointAndAdvance(pointData);
                    },
                    function(error) {
                        pointData.coordinates = {
                            error: 'Erro ao obter coordenadas: ' + error.message,
                            timestamp: new Date().toISOString()
                        };
                        
                        savePointAndAdvance(pointData);
                    }
                );
            } else {
                pointData.coordinates = {
                    error: 'GPS n√£o dispon√≠vel',
                    timestamp: new Date().toISOString()
                };
                
                savePointAndAdvance(pointData);
            }
        }

        // Coletar dados do ponto atual
        function collectCurrentPointData() {
            const pointData = {
                pointNumber: samplingData.currentPoint,
                deviceId: samplingData.deviceId,
                timestamp: new Date().toISOString(),
                generalInfo: collectGeneralInfo(),
                pests: {},
                beneficials: {},
                observations: {
                    pests: document.querySelector('textarea[placeholder*="outras pragas"]')?.value || '',
                    beneficials: document.querySelector('textarea[placeholder*="outros inimigos"]')?.value || ''
                },
                dataSource: 'local'
            };
            
            // Coletar dados de pragas
            document.querySelectorAll('.pest-input[data-pest]').forEach(input => {
                const pest = input.dataset.pest;
                const stage = input.dataset.stage;
                const value = parseInt(input.value) || 0;
                
                if (!pointData.pests[pest]) {
                    pointData.pests[pest] = {};
                }
                pointData.pests[pest][stage] = value;
            });
            
            // Coletar dados de inimigos naturais
            document.querySelectorAll('.pest-input[data-beneficial]').forEach(input => {
                const beneficial = input.dataset.beneficial;
                const stage = input.dataset.stage;
                const value = parseInt(input.value) || 0;
                
                if (!pointData.beneficials[beneficial]) {
                    pointData.beneficials[beneficial] = {};
                }
                pointData.beneficials[beneficial][stage] = value;
            });
            
            return pointData;
        }

        // Coletar informa√ß√µes gerais
        function collectGeneralInfo() {
            return {
                dataColeta: document.getElementById('dataColeta').value,
                nomeMonitor: document.getElementById('nomeMonitor').value,
                propriedade: document.getElementById('propriedade').value,
                cultivar: document.getElementById('cultivar').value,
                dataSemeadura: document.getElementById('dataSemeadura').value,
                loteTalhao: document.getElementById('loteTalhao').value,
                estagio: samplingData.stage
            };
        }

        // Salvar ponto e avan√ßar
        function savePointAndAdvance(pointData) {
            samplingData.points.push(pointData);
            
            // Limpar campos para pr√≥ximo ponto
            clearPointInputs();
            
            // Avan√ßar para pr√≥ximo ponto
            if (samplingData.currentPoint <= samplingData.totalPoints) {
                samplingData.currentPoint++;
                document.getElementById('currentPoint').textContent = samplingData.currentPoint;
            }
            
            updateProgress();
            updateLocalPointsCount();
            saveData();
            showSyncIndicator('success');
        }

        // Limpar campos do ponto
        function clearPointInputs() {
            document.querySelectorAll('.pest-input').forEach(input => {
                input.value = '';
            });
            
            document.querySelectorAll('textarea').forEach(textarea => {
                if (textarea.placeholder.includes('outras') || textarea.placeholder.includes('outros')) {
                    textarea.value = '';
                }
            });
        }

        // Atualizar barra de progresso
        function updateProgress() {
            const progress = (samplingData.currentPoint - 1) / samplingData.totalPoints * 100;
            const progressBar = document.querySelector('.progress-bar');
            const progressText = document.getElementById('progressText');
            const progressPercent = document.getElementById('progressPercent');
            
            progressBar.style.setProperty('--progress', progress + '%');
            progressText.textContent = `Ponto ${samplingData.currentPoint} de ${samplingData.totalPoints}`;
            progressPercent.textContent = Math.round(progress) + '%';
            
            if (progress === 100) {
                progressText.textContent = 'Amostragem conclu√≠da!';
            }
        }

        // Configurar auto-save
        function setupAutoSave() {
            // Auto-save em mudan√ßas nos campos
            document.querySelectorAll('input, textarea, select').forEach(element => {
                element.addEventListener('change', saveData);
                element.addEventListener('input', debounce(saveData, 1000));
            });
        }

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Salvar dados
        function saveData() {
            samplingData.generalInfo = collectGeneralInfo();
            samplingData.metadata.lastModified = new Date().toISOString();
            localStorage.setItem('mipSojaDataSemImagens', JSON.stringify(samplingData));
            document.getElementById('lastSync').textContent = '√öltima sincroniza√ß√£o: ' + new Date().toLocaleTimeString();
        }

        // Carregar dados salvos
        function loadSavedData() {
            const savedData = localStorage.getItem('mipSojaDataSemImagens');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    
                    // Manter deviceId atual se n√£o existir nos dados salvos
                    if (!parsedData.deviceId) {
                        parsedData.deviceId = samplingData.deviceId;
                    }
                    
                    samplingData = parsedData;
                    
                    // Restaurar informa√ß√µes gerais
                    if (samplingData.generalInfo) {
                        Object.keys(samplingData.generalInfo).forEach(key => {
                            const element = document.getElementById(key);
                            if (element) {
                                element.value = samplingData.generalInfo[key];
                            }
                        });
                    }
                    
                    // Restaurar estado da amostragem
                    if (samplingData.totalPoints && samplingData.currentPoint) {
                        document.getElementById('totalPoints').textContent = samplingData.totalPoints;
                        document.getElementById('currentPoint').textContent = samplingData.currentPoint;
                        document.getElementById('dataCollection').style.display = 'block';
                        document.getElementById('samplingModal').style.display = 'none';
                        updateProgress();
                    }
                    
                    updateLocalPointsCount();
                    
                } catch (error) {
                    console.error('Erro ao carregar dados salvos:', error);
                }
            }
        }

        // Mostrar indicador de sincroniza√ß√£o
        function showSyncIndicator(type) {
            const indicator = document.getElementById('syncIndicator');
            indicator.className = `data-sync-indicator sync-${type}`;
            
            switch(type) {
                case 'success':
                    indicator.textContent = '‚úÖ Dados salvos';
                    break;
                case 'pending':
                    indicator.textContent = '‚è≥ Salvando...';
                    break;
                case 'error':
                    indicator.textContent = '‚ùå Erro ao salvar';
                    break;
            }
            
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 3000);
        }

        // Exportar para CSV
        function exportCSV() {
    if (samplingData.points.length === 0) {
        alert('Nenhum dado para exportar. Adicione pelo menos um ponto de amostragem.');
        return;
    }

    // 1. Criamos uma lista que vai armazenar todas as nossas linhas
    const rows = [];

    // 2. Definimos todos os cabe√ßalhos de uma vez em uma lista
    const headers = [
        'Ponto', 'Dispositivo', 'Data/Hora', 'Latitude', 'Longitude', 'Monitor', 'Propriedade', 'Cultivar', 'Estagio', 'Fonte',
        'Lagarta_soja_pequena', 'Lagarta_soja_grande',
        'Lagarta_falsa_medideira_pequena', 'Lagarta_falsa_medideira_grande',
        'Lagarta_vagens_pequena', 'Lagarta_vagens_grande',
        'Lagarta_heliothinae_pequena', 'Lagarta_heliothinae_grande',
        'Percevejo_verde_ninfa', 'Percevejo_verde_adulto',
        'Percevejo_pequeno_ninfa', 'Percevejo_pequeno_adulto',
        'Percevejo_marrom_ninfa', 'Percevejo_marrom_adulto',
        'Percevejo_barriga_verde_ninfa', 'Percevejo_barriga_verde_adulto',
        'Broca_ponteiros_plantas', 'Tamandua_soja_adulto',
        'Vaquinhas_adulto', 'Torraozinho_adulto',
        'Nomuraea', 'Baculovirus', 'Calosoma', 'Callida_sp', 'Callida_scutellaris',
        'Lebia_concinna', 'Eriopsis_connexa', 'Cycloneda_sanguinea',
        'Podisus_sp', 'Tropiconabis_sp', 'Geocoris_sp', 'Doru_sp', 'Aranhas',
        'Observacoes_pragas', 'Observacoes_inimigos'
    ];
    
    // Adicionamos a linha de cabe√ßalho √† nossa lista de linhas
    rows.push(headers.join(','));

    // 3. Agora, iteramos sobre cada ponto de coleta para criar as linhas de dados
    samplingData.points.forEach(point => {
        // Mapeamos os cabe√ßalhos para os valores correspondentes no ponto
        const rowData = [
            point.pointNumber,
            point.deviceId || samplingData.deviceId,
            point.timestamp,
            point.coordinates?.latitude || '',
            point.coordinates?.longitude || '',
            point.generalInfo?.nomeMonitor || '',
            point.generalInfo?.propriedade || '',
            point.generalInfo?.cultivar || '',
            point.generalInfo?.estagio || '',
            point.dataSource || 'local',
            // Pragas
            point.pests?.lagarta_soja?.pequena || 0, point.pests?.lagarta_soja?.grande || 0,
            point.pests?.lagarta_falsa_medideira?.pequena || 0, point.pests?.lagarta_falsa_medideira?.grande || 0,
            point.pests?.lagarta_vagens?.pequena || 0, point.pests?.lagarta_vagens?.grande || 0,
            point.pests?.lagarta_heliothinae?.pequena || 0, point.pests?.lagarta_heliothinae?.grande || 0,
            point.pests?.percevejo_verde?.ninfa || 0, point.pests?.percevejo_verde?.adulto || 0,
            point.pests?.percevejo_pequeno?.ninfa || 0, point.pests?.percevejo_pequeno?.adulto || 0,
            point.pests?.percevejo_marrom?.ninfa || 0, point.pests?.percevejo_marrom?.adulto || 0,
            point.pests?.percevejo_barriga_verde?.ninfa || 0, point.pests?.percevejo_barriga_verde?.adulto || 0,
            point.pests?.broca_ponteiros?.plantas || 0,
            point.pests?.tamandua_soja?.adulto || 0,
            point.pests?.vaquinhas?.adulto || 0,
            point.pests?.torraozinho?.adulto || 0,
            // Inimigos Naturais
            point.beneficials?.nomuraea?.contagem || 0,
            point.beneficials?.baculovirus?.contagem || 0,
            point.beneficials?.calosoma?.contagem || 0,
            point.beneficials?.callida_sp?.contagem || 0,
            point.beneficials?.callida_scutellaris?.contagem || 0,
            point.beneficials?.lebia_concinna?.contagem || 0,
            point.beneficials?.eriopsis_connexa?.contagem || 0,
            point.beneficials?.cycloneda_sanguinea?.contagem || 0,
            point.beneficials?.podisus_sp?.contagem || 0,
            point.beneficials?.tropiconabis_sp?.contagem || 0,
            point.beneficials?.geocoris_sp?.contagem || 0,
            point.beneficials?.doru_sp?.contagem || 0,
            point.beneficials?.aranhas?.contagem || 0,
            // Observa√ß√µes (garantindo que as aspas sejam tratadas corretamente)
            `"${(point.observations?.pests || '').replace(/"/g, '""')}"`,
            `"${(point.observations?.beneficials || '').replace(/"/g, '""')}"`
        ];
        
        // Adicionamos a linha de dados formatada √† nossa lista de linhas
        rows.push(rowData.join(','));
    });

    // 4. Juntamos todas as linhas (cabe√ßalho + dados) com a quebra de linha correta
    const csvContent = rows.join('\r\n');

    // 5. Criamos e disparamos o download do arquivo
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `IAgro_sem_imagens_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showSyncIndicator('success');
}
            
           
        // Exportar para JSON
        function exportJSON() {
            if (samplingData.points.length === 0) {
                alert('Nenhum dado para exportar. Adicione pelo menos um ponto de amostragem.');
                return;
            }
            
            const dataToExport = {
                ...samplingData,
                exportDate: new Date().toISOString(),
                version: '3.0-sem-imagens'
            };
            
            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `IAgro_sem_imagens_${samplingData.deviceId}_${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSyncIndicator('success');
        }

        // Importar dados
        function importData() {
            document.getElementById('importFile').click();
        }

        // Manipular importa√ß√£o de arquivo
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Verificar se √© um arquivo v√°lido
                    if (!importedData.points || !Array.isArray(importedData.points)) {
                        alert('Arquivo inv√°lido. Por favor, selecione um arquivo JSON v√°lido da I.');
                        return;
                    }
                    
                    // Preparar dados para mesclagem
                    pendingMergeData = importedData;
                    showMergeModal(importedData);
                    
                } catch (error) {
                    alert('Erro ao importar arquivo. Verifique se o arquivo √© um JSON v√°lido.');
                    console.error('Erro na importa√ß√£o:', error);
                }
            };
            
            reader.readAsText(file);
            event.target.value = ''; // Limpar input
        }

        // Mostrar modal de mesclagem
        function showMergeModal(importedData) {
            const modal = document.getElementById('mergeModal');
            const content = document.getElementById('mergeContent');
            
            const deviceConflict = importedData.deviceId === samplingData.deviceId;
            const hasLocalData = samplingData.points.length > 0;
            
            content.innerHTML = `
                <div class="mb-4">
                    <h4 class="font-semibold text-gray-800 mb-2">Dados a serem importados:</h4>
                    <div class="bg-blue-50 p-3 rounded">
                        <p><strong>Dispositivo:</strong> ${importedData.deviceId || 'N√£o identificado'}</p>
                        <p><strong>Pontos:</strong> ${importedData.points.length}</p>
                        <p><strong>√öltima modifica√ß√£o:</strong> ${new Date(importedData.metadata?.lastModified || importedData.exportDate).toLocaleString()}</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="font-semibold text-gray-800 mb-2">Dados locais atuais:</h4>
                    <div class="bg-gray-50 p-3 rounded">
                        <p><strong>Dispositivo:</strong> ${samplingData.deviceId}</p>
                        <p><strong>Pontos:</strong> ${samplingData.points.length}</p>
                        <p><strong>√öltima modifica√ß√£o:</strong> ${samplingData.metadata?.lastModified ? new Date(samplingData.metadata.lastModified).toLocaleString() : 'N√£o dispon√≠vel'}</p>
                    </div>
                </div>
                
                ${deviceConflict ? `
                    <div class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
                        <p class="text-yellow-800"><strong>‚ö†Ô∏è Aten√ß√£o:</strong> Os dados s√£o do mesmo dispositivo. Pontos duplicados ser√£o identificados e podem ser mesclados.</p>
                    </div>
                ` : ''}
                
                <div class="mb-4">
                    <h4 class="font-semibold text-gray-800 mb-2">Op√ß√µes de mesclagem:</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="mergeOption" value="append" checked class="mr-2">
                            <span>Adicionar aos dados existentes (recomendado)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="mergeOption" value="replace" class="mr-2">
                            <span>Substituir todos os dados locais</span>
                        </label>
                        ${hasLocalData ? `
                            <label class="flex items-center">
                                <input type="radio" name="mergeOption" value="merge" class="mr-2">
                                <span>Mesclar inteligentemente (evitar duplicatas)</span>
                            </label>
                        ` : ''}
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        // Fechar modal de mesclagem
        function closeMergeModal() {
            document.getElementById('mergeModal').style.display = 'none';
            pendingMergeData = null;
        }

        // Confirmar mesclagem
        function confirmMerge() {
            if (!pendingMergeData) return;
            
            const mergeOption = document.querySelector('input[name="mergeOption"]:checked').value;
            
            switch(mergeOption) {
                case 'append':
                    // Adicionar pontos importados aos existentes
                    pendingMergeData.points.forEach(point => {
                        point.dataSource = 'imported';
                        samplingData.points.push(point);
                    });
                    break;
                    
                case 'replace':
                    // Substituir todos os dados
                    samplingData = {
                        ...pendingMergeData,
                        deviceId: samplingData.deviceId // Manter deviceId local
                    };
                    break;
                    
                case 'merge':
                    // Mesclagem inteligente
                    const existingPoints = new Set(samplingData.points.map(p => 
                        `${p.pointNumber}_${p.timestamp}_${p.deviceId}`
                    ));
                    
                    pendingMergeData.points.forEach(point => {
                        const pointKey = `${point.pointNumber}_${point.timestamp}_${point.deviceId}`;
                        if (!existingPoints.has(pointKey)) {
                            point.dataSource = 'merged';
                            samplingData.points.push(point);
                        }
                    });
                    break;
            }
            
            // Atualizar metadados
            samplingData.metadata.lastModified = new Date().toISOString();
            
            // Salvar e atualizar interface
            saveData();
            updateLocalPointsCount();
            closeMergeModal();
            showSyncIndicator('success');
            
            alert(`Dados importados com sucesso! ${samplingData.points.length} pontos no total.`);
        }

// Substitua a sua fun√ß√£o `generateConsolidatedReport` por esta vers√£o corrigida:
async function generateConsolidatedReport() {
    if (samplingData.points.length === 0) {
        alert('Nenhum dado dispon√≠vel para enviar para an√°lise.');
        return;
    }

    showSyncIndicator('pending');

    try {
        // üîß Corre√ß√£o: agora envia para o endpoint correto /analisar
        const response = await fetch(`${serverUrl}/analisar`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(samplingData.points),
        });

        if (!response.ok) {
            throw new Error(`Erro do servidor: ${response.status} ${response.statusText}`);
        }

        const result = await response.json();

        // O backend retorna { texto: resposta } ‚Üí ajustado aqui:
        if (result.erro) {
            showSyncIndicator('error');
            alert('Erro na an√°lise: ' + result.erro);
            return;
        }

        showSyncIndicator('success');
        // Mostra o texto retornado pelo Gemini no modal
        showGeminiReportModal(result.texto);

    } catch (error) {
        showSyncIndicator('error');
        console.error('Erro ao chamar o servidor:', error);
        alert('Ocorreu um erro ao conectar com o servidor. Verifique se ele est√° rodando.');
    }
}


function showGeminiReportModal(analysisText) {
  const modal = document.getElementById('reportModal');
  const content = document.getElementById('reportContent');

  // Remove caracteres de Markdown e s√≠mbolos especiais
  let cleanText = analysisText
    .replace(/\*\*/g, '')        // remove **
    .replace(/\*/g, '')          // remove *
    .replace(/#/g, '')           // remove #
    .replace(/`/g, '')           // remove `
    .replace(/\|/g, '')          // remove |
    .replace(/_{1,2}/g, '')      // remove _
    .replace(/:{1,}[-:]{2,}:{0,}/g, '') // remove linhas tipo ':---:' de tabelas markdown
    .replace(/\n{3,}/g, '\n\n')  // limita quebras de linha excessivas
    .trim();

  // Deixa o texto visualmente organizado
  cleanText = cleanText
    .replace(/\n\d+\.\s/g, '<br><b>$&</b>') // numera√ß√£o destacada
    .replace(/\n-\s/g, '<br>‚Ä¢ ')            // marcadores
    .replace(/\n/g, '<br>');                // quebra de linha para HTML

  // Exibe o conte√∫do formatado dentro do modal
  content.innerHTML = `
    <div class="bg-white p-10 rounded-2xl shadow-lg text-gray-800 leading-relaxed tracking-wide">
      <h2 class="text-3xl font-bold text-gray-900 border-b pb-2 mb-6 text-center">
        Relat√≥rio Consolidado
      </h2>
      <div class="text-justify text-gray-800 whitespace-pre-line indent-8">
        ${cleanText}
      </div>
    </div>
  `;

  // Mostra o modal
  modal.style.display = 'flex';
}


        // Sincronizar com nuvem (simulado)
        function syncWithCloud() {
            showSyncIndicator('pending');
            
            // Simular sincroniza√ß√£o
            setTimeout(() => {
                // Aqui seria implementada a sincroniza√ß√£o real com um servidor
                showSyncIndicator('success');
                alert('Funcionalidade de sincroniza√ß√£o com nuvem ser√° implementada em vers√£o futura.');
            }, 2000);
        }

        // Limpar dados
        function clearData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                localStorage.removeItem('mipSojaDataSemImagens');
                location.reload();
            }
        }
    </script>

<!-- Biblioteca √∫nica e est√°vel -->
<!-- Biblioteca √∫nica e est√°vel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('reportModal');
  const closeBtn = document.getElementById('closeReportBtn');
  const exportBtn = document.getElementById('exportReportBtn');
  const reportContent = document.getElementById('reportContent');

  // === Fechar o modal ===
  closeBtn.addEventListener('click', () => {
    modal.style.display = 'none';
  });

  // === Exportar relat√≥rio em PDF (vers√£o final sem cortes e centralizada) ===
  exportBtn.addEventListener('click', async () => {
    if (!reportContent || reportContent.innerText.trim() === '') {
      alert('‚ö†Ô∏è Nenhum relat√≥rio dispon√≠vel para exportar.');
      return;
    }

    // Clona o conte√∫do para n√£o interferir no modal
    const clone = reportContent.cloneNode(true);

    // Cria uma √°rea limpa e formatada para gerar o PDF
    const wrapper = document.createElement('div');
    wrapper.style.width = '190mm';          // largura √∫til da p√°gina A4
    wrapper.style.minHeight = '277mm';      // altura m√≠nima
    wrapper.style.margin = '0 auto';
    wrapper.style.padding = '20mm 15mm';    // margens internas
    wrapper.style.backgroundColor = '#ffffff';
    wrapper.style.fontFamily = 'Calibri, Arial, sans-serif';
    wrapper.style.lineHeight = '1.6';
    wrapper.style.fontSize = '12pt';
    wrapper.style.color = '#222';
    wrapper.style.textAlign = 'justify';
    wrapper.style.boxSizing = 'border-box';

    // Cabe√ßalho e conte√∫do
    wrapper.innerHTML = `
      <div style="text-align:center; margin-bottom:15mm;">
        <h1 style="margin:0; font-size:22pt; font-weight:bold; color:#003366;">IAgro</h1>
        <h2 style="margin:6pt 0 0; font-size:14pt; font-weight:normal;">Relat√≥rio Consolidado</h2>
        <hr style="margin-top:8mm; border:0; border-top:1px solid #ccc; width:85%;">
      </div>

      <div style="padding:0 5mm;">
        ${clone.innerHTML}
      </div>

      <hr style="margin-top:12mm; border:0; border-top:1px solid #ccc; width:85%;">
      <div style="text-align:center; font-size:10pt; margin-top:6mm; color:#555;">
        Gerado automaticamente em ${new Date().toLocaleDateString('pt-BR')}
      </div>
    `;

    document.body.appendChild(wrapper);

    // Op√ß√µes otimizadas para centraliza√ß√£o e margens reais
    const opt = {
      margin: [10, 10, 10, 10], // margens fixas
      filename: `Relatorio_MIP_${new Date().toISOString().slice(0,10)}.pdf`,
      image: { type: 'jpeg', quality: 1 },
      html2canvas: {
        scale: 1.4,               // escala equilibrada (evita corte)
        useCORS: true,
        scrollY: 0,
        backgroundColor: '#ffffff',
        windowWidth: 850,         // largura A4 ajustada
        windowHeight: 1200        // altura proporcional
      },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
      pagebreak: {
        mode: ['avoid-all', 'css', 'legacy'],
        before: ['#page-break', '.page-break'],
        avoid: ['h2', 'h3', 'img']
      }
    };

    try {
      await html2pdf().set(opt).from(wrapper).save();
      alert('‚úÖ Relat√≥rio exportado com margens perfeitas e sem cortes!');
    } catch (err) {
      console.error('Erro ao gerar PDF:', err);
      alert('‚ùå Ocorreu um erro ao gerar o PDF.');
    } finally {
      document.body.removeChild(wrapper);
    }
  });
});
</script>



